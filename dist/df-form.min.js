!function(e){e.module("df.form.config",[]).value("df.form.config",{debug:!0}),e.module("df.form.directive",[]),e.module("df.form.service",[]),e.module("df.form",["df.form.config","df.form.directive","df.form.service","df.validator","ngSanitize"])}(angular),angular.module("df.form.directive").directive("dfButton",function(){return{restrict:"E",require:"^?form",priority:-1,scope:{text:"@label",icon:"@?",iconSize:"@?",disableOnInvalid:"@?",classes:"@",ngDisabled:"="},templateUrl:function(e,t){return t.icon?"formBundle/templates/df-icon-button.html":"formBundle/templates/df-button.html"},link:function(e,t,n,r){if(e.iconSize=e.iconSize||24,e.isDisabled=!1,e.buttonClass=[],e.buttonClass.push("pp-btn"),e.classes&&e.buttonClass.push(e.classes),e.$eval(n.primary)&&e.buttonClass.push("lgreen"),e.$eval(n.warn)&&e.buttonClass.push("red"),e.$eval(n.secondary)&&e.buttonClass.push("blue"),r&&e.disableOnInvalid){var i=r;angular.isString(e.disableOnInvalid)&&r[e.disableOnInvalid]&&(i=r[e.disableOnInvalid]),e.$watch(function(){return i.$invalid},function(t){e.isDisabled=!!t})}}}}),angular.module("df.form.directive").directive("dfDatepicker",function(e,t){return{restrict:"EA",require:["^ngModel","^?form","^?dfField"],scope:{fid:"@?fid",tabindex:"@?",placeholder:"@?",value:"=ngModel",name:"@?",format:"@",initDate:"=?",minDate:"=?",maxDate:"=?"},templateUrl:"formBundle/templates/df-datepicker.html",compile:function(n,r){return angular.isUndefined(r.fid)&&(r.fid=e.nextUid()),{pre:function(e,n,r,i){var l=i[0],a=i[1],u=t(r.ngDisabled);l.isDisabled=e.isDisabled=function(){return a&&a.dfDisabled||u(e.$parent)},e.type=r.type||"text",e.name=e.name||r.ngModel},post:function(t,n,r,i){angular.element(n).addClass("pp-datepicker"),t.options={},t.open=function(e){if(e.stopPropagation(),e.preventDefault(),!t.isDisabled()){var r=angular.element(n).find("datepicker")[0],i=angular.element(r).find("div");angular.forEach(i,function(e){e=angular.element(e),e.hasClass("_720kb-datepicker-calendar")&&e.toggleClass("_720kb-datepicker-open")})}};var l=i[2],a=i[0];l&&l.onWidgetAdded(t.fid,a.$name,"dfDatepicker"),e.applyValidation(i[0],i[1],t)}}}}}),angular.module("df.form.directive").directive("dfError",function(e){return{restrict:"EA",require:["^?form","^?ngModel"],scope:!0,templateUrl:"formBundle/templates/df-error.html",compile:function(){return{post:function(t,n,r,i){t.errors=[];var l=i[1]||{},a=r.count||1;r.forName&&i[0]&&i[0][r.forName]&&(l=i[0][r.forName]),t.$watch(function(){var e=!1;return l.$invalid&&(l.$dirty?e=!0:void 0!==l.$modelValue&&0!==l.$modelValue.length&&(e=!0)),e},function(n){if(n){var r=[],i=0;angular.forEach(l.$error,function(t,n){a>i&&!l.$errorMessages[n]&&(i++,r.push(e.getMessageForError(n)))}),angular.forEach(l.$errorMessages,function(e){e&&a>i&&(i++,r.push(e))}),t.errors=r}else t.errors=[]})}}}}}),angular.module("df.form.directive").controller("df.formBundle").directive("dfField",function(){return{restrict:"E",transclude:!0,require:["^?form","dfField"],scope:!1,templateUrl:"formBundle/templates/df-field.html",compile:function(){return{post:function(e,t,n,r,i){{var l=angular.element(t).find("widget");r[1]}i(e,function(e){l.append(e)})}}},controller:function(e,t,n,r,i,l){this.onWidgetAdded=function(a,u){if(this.fid=a,this.field_name=u,r(angular.element('<df-error for-name="'+u+'"></df-error>'))(e,function(e){angular.element(t).append(e)}),n.label){var o=i(l.get("formBundle/templates/df-field-label.html"))({label:n.label,tooltip:n.tooltip,required:n.required,fid:a,name:u});r(angular.element(o))(e,function(e){angular.element(t).prepend(e)})}}}}}),angular.module("df.form.directive").directive("dfFormDisabled",function(e,t){return{restrict:"A",require:"^form",link:function(e,n,r,i){r.$observe("dfFormDisabled",function(e){i.dfDisabled=t(e)()})}}}),angular.module("df.form.directive").directive("dfInput",function(e,t,n){return{restrict:"EA",require:["^ngModel","^?form","^?dfField"],scope:{fid:"@?fid",value:"=ngModel",type:"@?",tabindex:"@?",placeholder:"@?",symbol:"@?",inputValue:"@?"},templateUrl:function(e,t){return t.hasOwnProperty("textarea")&&"false"!==t.textarea?"formBundle/templates/df-textarea.html":"formBundle/templates/df-input.html"},compile:function(r,i){return angular.isUndefined(i.fid)&&(i.fid=e.nextUid()),{pre:function(e,r,i,l){var a=t(i.ngDisabled),u=l[0],o=l[1];u.isDisabled=e.isDisabled=function(){return o&&o.dfDisabled||a(e.$parent)};var d=i.type||"text";if(e.textarea=i.hasOwnProperty("textarea")&&"false"!==i.textarea,!e.textarea){var s="";e.inputValue&&(s='value="'+e.inputValue+'"');var c='<input id="{{::fid}}" type="'+d+'"ng-class="{symbol: symbol}" tabindex="{{::tabIndex}}" placeholder="{{::placeholder}}" '+s+'ng-model="value" ng-model-options="{ updateOn: \'default blur\', debounce: {\'default\': 500, \'blur\': 0} }" ng-disabled="isDisabled()" ng-change="onValueChanged()"/>';n(angular.element(c))(e,function(e){angular.element(r).append(e)})}},post:function(t,n,r,i){var l=i[2],a=i[0];l&&l.onWidgetAdded(t.fid,a.$name,"dfInput"),e.applyValidation(i[0],i[1],t)}}}}}),angular.module("df.form.directive").directive("dfLabel",function(){return{restrict:"E",require:"^form",scope:{required:"@",label:"@",tooltip:"@",forAttr:"@for"},templateUrl:"formBundle/templates/df-label.html"}}),angular.module("df.form.directive").directive("dfLinkedWith",function(){return{restrict:"A",require:["^ngModel","^?form"],scope:!1,link:function(e,t,n,r){var i=r[1],l=r[0];e.$watch(function(){return l.$modelValue},function(){i[n.dfLinkedWith]&&(i[n.dfLinkedWith].$setDirty(),i[n.dfLinkedWith].$setTouched(),i[n.dfLinkedWith].$validate())})}}}),angular.module("df.form.directive").directive("dfSelect",function(e,t){return{restrict:"E",require:["^ngModel","^?form","^?dfField"],scope:{fid:"@?fid",value:"=ngModel",options:"=",name:"@?",tabindex:"@?"},templateUrl:"formBundle/templates/df-select.html",link:function(n,r,i,l){var a=l[2],u=l[0],o=t(i.ngDisabled),d=l[1];u.isDisabled=n.isDisabled=function(){return d&&d.dfDisabled||o(n.$parent)},a&&a.onWidgetAdded(n.fid,u.$name,"dfDatepicker"),e.applyValidation(l[0],l[1],n)}}}),angular.module("df.form.directive").directive("dfSelectbox",function(e,t,n){return{restrict:"E",require:["^ngModel","^?form","^?dfField"],transclude:!0,controllerAs:"vm",templateUrl:"formBundle/templates/df-selectbox.html",scope:{value:"=ngModel",filter:"=?filter",onFilterChanged:"&",onItemSelected:"&",allowIcon:"=?",iconClass:"@?"},link:{pre:function(e,t,r,i){var l=n(r.ngDisabled),a=i[0],u=i[1];a.isDisabled=e.isDisabled=function(){return u&&u.dfDisabled||l(e.$parent)},e.view={show:!1,selectElement:angular.element(t)[0],listElement:angular.element(t).find("ng-transclude")[0],instanceId:"inst-"+Date.now(),type:r.type||"selectbox",placeholder:r.placeholder,isEmptyAllowed:e.$eval(r.allowEmpty)===!0,isFilterEnabled:e.$eval(r.allowFilter)===!0,disabled:e.disable},e.view.isFilterEnabled&&(e.view.searhElement=angular.element(t).find("input")[0],e.$watch("view.search",function(t){e.filter=t,e.onFilterChanged({criteria:t})})),t.addClass("pp-selectbox"),r.id||t.attr("id",e.view.instanceId);for(var o=0,d=angular.element(t).children();o<d.length;o++)if(angular.element(d[o]).hasClass("select-input")){e.view.selectElement=d[o];break}},post:function(t,n,r,i){var l=i[2];t.ngModel=i[0],l&&l.onWidgetAdded(t.fid,t.ngModel.$name,"dfSelectbox"),e.applyValidation(i[0],i[1],t)}},controller:function(e,n,r){function i(t){return 0===t.length?!1:e.view.selectElement===t[0]?!0:i(t.parent())}function l(t){if(-1!==[13].indexOf(t.keyCode)&&void 0!==e.view.focus)return a(angular.element(e.view.listElement).children()[e.view.focus]),o(),d.updateValue(),e.$apply(),!1;if(-1===[38,40].indexOf(t.keyCode))return!1;var n=0,r=d.getCurrentItemsLength()-1;e.view.focus=void 0!==e.view.focus?e.view.focus:-1,angular.element(e.view.listElement).children().removeClass("focused"),40===t.keyCode&&(e.view.focus===r?e.view.focus=n:e.view.focus+=1),38===t.keyCode&&(e.view.focus<=n?e.view.focus=r:e.view.focus-=1),e.view.focus>=0&&angular.element(angular.element(e.view.listElement).children()[e.view.focus]).addClass("focused"),e.$apply();var i=e.view.listElement,l=angular.element(e.view.listElement).children()[e.view.focus],u=i.offsetHeight,s=l.offsetHeight*(e.view.focus+1);s>=u?i.scrollTop=s:s<=i.scrollTop&&(i.scrollTop=0)}function a(t){var n=angular.element(t).scope();e.selectedItems[n.getItemIndex()]={label:n.getItemLabel(),value:n.getItemValue(),element:t}}function u(t){if(!e.isDisabled()){var n=angular.element(t).scope();delete e.selectedItems[n.getItemIndex()],0!==Object.keys(e.selectedItems).length||e.view.isEmptyAllowed||("multi"===e.view.type&&e.view.default&&(n=angular.element(e.view.default.element).scope()),e.selectedItems[n.getItemIndex()]={label:n.getItemLabel(),value:n.getItemValue(),element:t})}}function o(){angular.element(e.view.listElement).find("option-item").removeClass("selected"),angular.forEach(e.selectedItems,function(e){var t=angular.element(e.element);t.length>0&&angular.element(t).addClass("selected")})}var d=this;this.itemsList={},e.selectedItems={},e.$watch("value",function(t,n){if(void 0!==t&&t!==n){var r=d.getValue(),i=[].concat(t);if(r.length===i.length&&_.intersection(i,r).length===r.length)return d.updateLabel(),o(),void 0;e.selectedItems={},angular.forEach(d.itemsList,function(e){var t=angular.element(e).scope().getItemValue();-1!==i.indexOf(t)&&a(e)}),d.updateLabel(),o()}});var s=function(t){var n=angular.element(t.target),r=n.attr("id"),l="multi"===e.view.type;return r===e.view.instanceId||i(n)&&l?!1:(e.view.show=!1,e.$apply(),c(),void 0)},c=function(){e.view.focus=-1,r.unbind("click",s),n.off("keydown",l),o()};this.isItemSelected=function(t){return _.findWhere(e.selectedItems,{value:angular.element(t).scope().getItemValue()})},this.toggleList=function(){e.isDisabled()||(o(),e.view.show=!e.view.show,e.view.show?(t(function(){r.bind("click",s)},0),e.view.isFilterEnabled&&t(function(){e.view.searhElement.focus()})):c())},this.getCurrentItemsLength=function(){return Object.keys(d.itemsList).length},this.deselectById=function(t){e.isDisabled()||(delete e.selectedItems[t],d.updateValue())},this.getValue=function(){return _.map(e.selectedItems,function(e){var t=angular.element(e.element);return t.scope&&t.scope()?t.scope().getItemValue():e.value})},this.updateLabel=function(){if("multi"!==e.view.type){var t=Object.keys(e.selectedItems);e.label=t.length>0?e.selectedItems[t[0]].label:void 0}},this.updateValue=function(){var t=this.getValue();t="multi"===e.view.type?t:t[0],e.ngModel.$setViewValue(t)},this.onItemClicked=function(t,n){"multi"!==e.view.type?(e.selectedItems={},a(t,n)):this.isItemSelected(t,n)?u(t,n):a(t,n),o(),e.$apply(function(){d.updateValue(),e.onValueChanged&&e.onValueChanged(),e.onItemSelected("multi"!==e.view.type?{index:angular.element(t).scope().getItemIndex(),value:angular.element(t).scope().getItemValue(),label:angular.element(t).scope().getItemLabel()}:{values:_.map(e.selectedItems,function(e){return e.value}),items:_.map(e.selectedItems,function(e,t){return{index:t,label:e.label,value:e.value}})})})},this.setDefault=function(){void 0===e.value&&(a(e.default.element),o(),d.updateValue())},this.onItemAdded=function(t,n,r){{var i=angular.element(t).scope(),l=i.getItemValue();i.getItemLabel()}if(n=n||i.getItemIndex(),d.itemsList[n]=t,void 0!==l&&-1!==[].concat(e.value).indexOf(l)){var u=this.isItemSelected(t);u?u.element&&0!==angular.element(u.element).parent().length?a(t):u.element=t:a(t),angular.element(t).addClass("selected")}return(r||0===n&&!e.view.isEmptyAllowed)&&(void 0===e.value&&(e.value="multi"===e.view.type?[angular.element(t).scope().getItemValue()]:angular.element(t).scope().getItemValue()),e.view.default={index:n,element:t}),d.updateLabel(),this.getCurrentItemsLength()},this.onItemRemoved=function(t,n){if(delete d.itemsList[n],e.selectedItems[n]&&delete e.selectedItems[n].element,e.view.default&&e.view.default.index===n)if(e.view.isEmptyAllowed)delete e.view.default;else{var r=Object.keys(d.itemsList)[0];e.view.default={index:r,element:d.itemsList[r]}}}}}}).directive("optionItem",function(){return{restrict:"EA",require:"^dfSelectbox",scope:!0,link:function(e,t,n,r){var i=angular.element(t);i.addClass("select-item"),e.onItemSelected=function(t){r.onItemClicked(t,e.getItemIndex())},angular.element(t).on("click",function(n){return angular.element(t).attr("ignore")?(n.stopPropagation(),void 0):(e.onItemSelected(t),void 0)}),e.getItemValue=function(){try{return e.$eval(n.value)||n.value}catch(t){return n.value}},e.getItemLabel=function(){if(void 0===n.label)return angular.element(t).html();try{return e.$eval(n.label)||n.label}catch(r){return n.label}},e.getItemIndex=function(){return e.$index||e.index||e.$id},e.$on("$destroy",function(){r.onItemRemoved(t,e.getItemIndex())}),r.onItemAdded(t,e.getItemIndex(),e.$eval(n.default)===!0)}}}),angular.module("df.form.directive").directive("dfValidator",function(e,t,n,r){function i(e){return e&&angular.isFunction(e.then)}return{restrict:"EA",require:["^ngModel","^?form"],scope:!1,link:function(e,t,l,a){var u=a[1],o=a[0];o.$errorMessages=o.$errorMessages||{},angular.forEach(l,function(t,l){if(0===l.indexOf("df")){var a=l.replace("df","");if(a=a.substr(0,1).toLowerCase()+a.substr(1),n.has(a)){var d=n.get(a);o.$asyncValidators[a]=function(n,l){var s=u&&u.object?u.object:o;if(o.isDisabled&&o.isDisabled())return delete o.$errorMessages[a],r.resolve();var c;try{c=d.validate(l,s,e.$eval(t))}catch(f){return o.$errorMessages[a]=f.toString(),r.reject(f.toString())}return i(c)?c.then(function(){return delete o.$errorMessages[a],r.resolve()}).catch(function(e){return o.$errorMessages[a]=e.toString(),r.reject(e.toString())}):c?(delete o.$errorMessages[a],r.resolve()):(o.$errorMessages[a]=c.toString(),r.reject())}}}})}}}),angular.module("df.form.directive").directive("validationRules",function(){return{restrict:"EA",require:"^form",scope:{object:"=",rules:"=validationRules"},link:function(e,t,n,r){r.validationRules=e.rules,e.$watch("object",function(e){r.object=e})}}}),function(){"use strict";var e=["0","0","0"];angular.module("df.form.service").service("dfFormUtils",function(t,n){function r(){}return r.prototype={nextUid:function(){for(var t,n=e.length;n;){if(n--,t=e[n].charCodeAt(0),57==t)return e[n]="A",e.join("");if(90!=t)return e[n]=String.fromCharCode(t+1),e.join("");e[n]="0"}return e.unshift("0"),e.join("")},applyValidation:function(e,r,i){var l=e.$name;l&&(i&&(i.onValueChanged=function(){e.$setDirty(),e.$setTouched()}),r&&r.validationRules&&(e.$errorMessages=e.$errorMessages||{},e.$asyncValidators.dfForm=function(i,a){if(e.isDisabled&&e.isDisabled())return delete e.$errorMessages.dfForm,n.resolve();var u=t.validateFormField(a,i,r.object||r,l,r.validationRules);return u.then(function(){return delete e.$errorMessages.dfForm,!0}).catch(function(t){return e.$errorMessages.dfForm=t.toString(),n.reject(t.toString())})}))},getMessageForError:function(e){var t={required:"This field is required"};return t[e]||"Invalid Field"}},new r})}(),function(e){e.module("df.validator.config",[]).value("df.validator.config",{debug:!0}),e.module("df.validator.services",[]),e.module("df.validator",["df.validator.config","df.validator.services"])}(angular),angular.module("df.validator").service("defaultValidationRules",function(e,t,n,r,i){function l(t,n,r){var i=r.message?r.message:this.message;throw i=e(i)(angular.extend({value:t,object:n},r))}return{required:{message:"This field is required",validate:function(e,t,n){return n=n||{},e&&0!==e.length?!0:l.apply(this,[e,t,n])}},minlength:{message:"Must be at least {{rule}} characters",validate:function(e,t,n){return n=angular.isObject(n)?n:{rule:n},!e||e.length<n.rule?l.apply(this,[e,t,n]):!0}},maxlength:{message:"Must be fewer than {{rule}} characters",validate:function(e,t,n){return n=angular.isObject(n)?n:{rule:n},e&&e.length>n.rule?l.apply(this,[e,t,n]):!0}},equal:{message:"Must be equal",validate:function(e,t,n){n=angular.isObject(n)?n:{rule:n};var r=angular.isObject(n.rule)&&n.rule.field?i(n.rule.field)(t):n.rule,a=n.rule.byValue||!1;return a&&e!==r?l.apply(this,[e,t,n]):a||e==r?!0:l.apply(this,[e,t,n])}},notEqual:{message:"Must be equal",validate:function(e,t,n){n=angular.isObject(n)?n:{rule:n};var r=angular.isObject(n.rule)&&n.rule.field?i(n.rule.field)(t):n.rule,a=n.rule.byValue||!1;return a&&e===r?l.apply(this,[e,t,n]):a||e!=r?!0:l.apply(this,[e,t,n])}},type:{message:"Must be an {{rule}}",validate:function(e,t,n){if(n=angular.isObject(n)?n:{rule:n},!e)return!0;var r=e.toString();return"integer"===n.rule&&r&&!r.match(/^\-*[0-9]+$/)?l.apply(this,[e,t,n]):"number"===n.rule&&r&&!r.match(/^\-*[0-9\.]+$/)?l.apply(this,[e,t,n]):"negative"===n.rule&&r&&!r.match(/^\-[0-9\.]+$/)?l.apply(this,[e,t,n]):"positive"===n.rule&&r&&!r.match(/^[0-9\.]+$/)?l.apply(this,[e,t,n]):"email"===n.rule&&r&&!r.match(/^.+@.+$/)?l.apply(this,[e,t,n]):"phone"===n.rule&&r&&!r.match(/^\+?[0-9\-]+\*?$/)?l.apply(this,[e,t,n]):!0}},pattern:{message:"Invalid format",validate:function(e,t,n){n=angular.isObject(n)?n:{rule:n};var r=n.rule instanceof RegExp?n.rule:new RegExp(n.rule);return e&&!r.exec(e)?l.apply(this,[e,t,n]):!0}},custom:{message:"Invalid value",validate:function(e,t,n){return n.rule(e,t,n)}},lessThan:{message:"This field should be less than {{errorField}}",validate:function(e,t,n){n=angular.isObject(n)?n:{rule:n},n.rule=angular.isString(n.rule)?n.rule.split(/[ ,;]+/).filter(Boolean):[n.rule];var i=parseFloat(e),a=!0;isNaN(i)?a=!1:e=i;for(var u=0;u<n.rule.length;u++){var o=null,d=t[n.rule[u]]||n.rule[u];if(d){if(a){if(isNaN(parseFloat(d)))continue;o=d=parseFloat(d)}if(e>d)return o=null===o?r("humanize")(r("tableize")(n.rule[u])):o,l.apply(this,[e,t,angular.extend(n,{errorField:o})])}}return!0}},dateDiff:{message:"Invalid Date diff",validate:function(e,t,r){if(r.rule){var i=n(e),a=n(r.rule.field?t[r.rule.field].$modelValue||t[r.rule.field]:r.rule.date);if(r.rule.range=r.rule.range||0,r.rule.term=r.rule.term||"days",r.rule.more){if(i.diff(a,r.rule.term)<r.rule.range)return l.apply(this,[e,t,r])}else if(i.diff(a,r.rule.term)>r.rule.range)return l.apply(this,[e,t,r]);return!0}}}}}),function(){"use strict";angular.module("df.validator").service("dfValidationUtils",function(){function e(){}return e.prototype={flattenObjectKeys:function(e){for(var t=[],n=[{object:e,prefix:null}];;){if(0===n.length)break;var r=n.pop(),i=r.prefix?r.prefix+".":"";if("object"==typeof r.object)for(var l in r.object){var a=i+l;t.push(a),n.push({object:r.object[l],prefix:a})}}return t}},new e})}(),angular.module("df.validator").service("formValidator",function(e,t,n,r){function i(){}return i.prototype={$getRulesForFieldName:function(e,t){return t=t.replace(/\[[^\]]+\]/g,".collection.fields"),n(t)(e)},validateAll:function(){throw"Not Implemented"},validateField:function(t,n,i,l,a){a=angular.copy(a);var u=this.$getRulesForFieldName(a,l),o=n||t;if(angular.isString(o)&&(o=o.replace(/\s+$/,"")),!u)return e.resolve();var d=e.defer();return function s(t){function n(t){var n;if(r.has(t.name)){var l=r.get(t.name);try{n=l.validate(o,i,t)}catch(a){return e.reject(a.message||a||l.message)}return angular.isObject(n)&&angular.isFunction(n.then)?n.then(function(t){return e.when(t)},function(t){return e.reject(t||l.message)}):n?e.when(n):e.reject(l.message)}return e.reject("Unknown validation rule with name "+t.name)}var l=t.shift();return n(l).then(function(){return 0===t.length?d.resolve():s(t)}).catch(d.reject)}(u),d.promise}},new i}),angular.module("df.validator").service("objectValidator",function(e,t,n,r){function i(){}return i.prototype={$getRulesForFieldName:function(e,t){return t=t.replace(/\[[^\]]+\]/g,".collection.fields"),n(t)(e)},validateAll:function(e,n){var r=t.flattenObjectKeys(n);return this.validateFields(e,r,n)},validateFields:function(t,r,i){i=angular.copy(i);var l=e.defer(),a=[],u={};return angular.forEach(r,function(e){var r=this.$getRulesForFieldName(i,e);if(r){var l;l=this.validateField(t,e,i),l.then(angular.noop,function(t){n(e).assign(u,t)}),a.push(l)}},this),e.all(a).then(l.resolve,function(){l.reject(u)}),l.promise},validateField:function(t,i,l){var a=this.$getRulesForFieldName(l,i),u=n(i)(t);angular.isString(u)&&(u=u.replace(/\s+$/,""));var o=e.defer();return function d(n){function i(n){var i;if(r.has(n.name)){var l=r.get(n.name),a=n;try{i=l.validate(u,t,a)}catch(o){return e.reject(o||l.message)}return angular.isObject(i)&&angular.isFunction(i.then)?i.then(function(t){return e.when(t)},function(t){return e.reject(t||l.message)}):i?e.when(i):e.reject(l.message)}return e.reject("Unknown validation rule with name "+ruleName)}n.shift();return i(n).then(function(){return 0===n.length?o.resolve():d(n)}).catch(o.reject)}(a),o.promise},isCollectionRequired:function(e,t){var n=this.$getRulesForFieldName(t,e);return n&&n.collection&&n.collection.min&&(angular.isObject(n.collection.min)?n.collection.min.rule:n.collection.min)},isFieldRequired:function(e,t){var n=this.$getRulesForFieldName(t,e);return n&&n.required&&(angular.isObject(n.required)?n.required.rule:n.required)}},new i}),angular.module("df.validator").provider("validator",function(){var e={};this.add=function(t,n){return e[t]=n,this},this.addCollection=function(e){var t=this;angular.forEach(e,function(e,n){t.add(n,e.validators||e)})},this.remove=function(t){return delete e[t],this},this.has=function(t){return void 0!==e[t]},this.get=function(t){return e[t]||{}};var t=this;this.$get=function(e,n,r,i){function l(){}return l.prototype={add:function(e,n){return t.add(e,n),this},remove:function(e){return t.remove(e),this},has:function(e){return t.has(e)},get:function(e){return t.get(e)},addRule:function(e,t){return i.add(e,t),this},removeRule:function(e){return i.remove(e),this},hasRule:function(e){return i.has(e)},getRule:function(e){return i.get(e)},getValidationRules:function(e){return e=angular.isFunction(e)?this.get(e.constructor.name):e,e=angular.isString(e)?this.get(e):e},validate:function(e,t){return t=angular.isObject(t)?t:this.getValidationRules(t||e),n.validateAll(e,t)},validateField:function(e,t,r){var i=angular.isString(t)?[t]:t;return n.validateFields(e,i,this.getValidationRules(r||e))},validateFormField:function(e,t,n,i,l){return r.validateField(e,t,n,i,l)}},new l}}),angular.module("df.validator").service("validatorRulesCollection",function(e,t){var n={};this.add=function(e,t){if(angular.isFunction(t)&&(t={message:"Invalid value",validate:t}),!angular.isFunction(t.validate))throw"Invalid validator object type";return n[e]=t,this},this.remove=function(e){return delete n[e],this},this.has=function(e){return n[e]},this.get=function(e){return n[e]};var r=this;angular.forEach(t,function(e,t){r.add(t,e)})});